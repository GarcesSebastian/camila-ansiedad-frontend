<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Institucional - Camila</title>
    <link rel="stylesheet" href="../styles/main.css">
    <link rel="stylesheet" href="../styles/institutional-admin.css">
</head>
<body>
    <div class="institutional-container">
        <!-- Header -->
        <header class="institutional-header">
            <div class="header-left">
                <h1>üèõÔ∏è Panel Institucional</h1>
                <div class="institution-info">
                    <span id="institutionName">Cargando instituci√≥n...</span>
                    <span id="adminName">Administrador</span>
                </div>
            </div>
            <div class="header-actions">
                <button id="refreshBtn" class="btn-secondary">üîÑ Actualizar</button>
                <button id="settingsBtn" class="btn-secondary">‚öôÔ∏è Configuraci√≥n</button>
                <button id="logoutBtn" class="btn-logout">üö™ Cerrar Sesi√≥n</button>
            </div>
        </header>

        <!-- Main Content -->
        <div class="institutional-main">
            <!-- Sidebar -->
            <nav class="institutional-sidebar">
                <div class="nav-section">
                    <h3>Dashboard</h3>
                    <a href="#overview" class="nav-item active" data-section="overview">
                        üìä Resumen General
                    </a>
                    <a href="#structure" class="nav-item" data-section="structure">
                        üèóÔ∏è Estructura
                    </a>
                </div>
                
                <div class="nav-section">
                    <h3>Gesti√≥n de Usuarios</h3>
                    <a href="#students" class="nav-item" data-section="students">
                        üë• Estudiantes
                    </a>
                    <a href="#experts" class="nav-item" data-section="experts">
                        üë®‚Äç‚öïÔ∏è Expertos
                    </a>
                </div>

                <div class="nav-section">
                    <h3>An√°lisis y Reportes</h3>
                    <a href="#analytics" class="nav-item" data-section="analytics">
                        üìà Analytics
                    </a>
                    <a href="#reports" class="nav-item" data-section="reports">
                        üìã Reportes
                    </a>
                </div>

                <div class="nav-section">
                    <h3>Configuraci√≥n</h3>
                    <a href="#institution-settings" class="nav-item" data-section="institution-settings">
                        ‚öôÔ∏è Instituci√≥n
                    </a>
                </div>
            </nav>

            <!-- Content Area -->
            <div class="institutional-content">
                <!-- Overview Section -->
                <section id="overview-section" class="section active">
                    <div class="section-header">
                        <h2>Resumen Institucional</h2>
                        <div class="time-filter">
                            <select id="overviewTimeRange">
                                <option value="7">√öltimos 7 d√≠as</option>
                                <option value="30" selected>√öltimos 30 d√≠as</option>
                                <option value="90">√öltimos 3 meses</option>
                            </select>
                        </div>
                    </div>

                    <div class="overview-stats">
                        <div class="stat-row">
                            <div class="stat-card large">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-info">
                                    <h3 id="totalStudents">0</h3>
                                    <p>Estudiantes Activos</p>
                                    <div class="stat-trend" id="studentsTrend">
                                        <span class="trend-icon">‚Üí</span>
                                        <span class="trend-text">Estable</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="stat-card large">
                                <div class="stat-icon">üí¨</div>
                                <div class="stat-info">
                                    <h3 id="totalConversations">0</h3>
                                    <p>Conversaciones Totales</p>
                                    <div class="stat-trend" id="conversationsTrend">
                                        <span class="trend-icon">‚Üí</span>
                                        <span class="trend-text">Estable</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="risk-stats">
                            <div class="risk-card high-risk">
                                <div class="risk-header">
                                    <div class="risk-icon">‚ö†Ô∏è</div>
                                    <div class="risk-info">
                                        <h4 id="highRiskCount">0</h4>
                                        <p>Alto Riesgo</p>
                                    </div>
                                </div>
                                <div class="risk-percentage" id="highRiskPercentage">0%</div>
                            </div>
                            
                            <div class="risk-card medium-risk">
                                <div class="risk-header">
                                    <div class="risk-icon">üî∏</div>
                                    <div class="risk-info">
                                        <h4 id="mediumRiskCount">0</h4>
                                        <p>Riesgo Moderado</p>
                                    </div>
                                </div>
                                <div class="risk-percentage" id="mediumRiskPercentage">0%</div>
                            </div>
                            
                            <div class="risk-card low-risk">
                                <div class="risk-header">
                                    <div class="risk-icon">‚úÖ</div>
                                    <div class="risk-info">
                                        <h4 id="lowRiskCount">0</h4>
                                        <p>Riesgo Leve</p>
                                    </div>
                                </div>
                                <div class="risk-percentage" id="lowRiskPercentage">0%</div>
                            </div>
                        </div>
                    </div>

                    <div class="overview-charts">
                        <div class="chart-row">
                            <div class="chart-card">
                                <h3>Distribuci√≥n por Programa</h3>
                                <div id="programDistributionChart" class="chart-container">
                                    <!-- Gr√°fico por programa -->
                                </div>
                            </div>
                            <div class="chart-card">
                                <h3>Actividad por Facultad</h3>
                                <div id="facultyActivityChart" class="chart-container">
                                    <!-- Gr√°fico por facultad -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="recent-alerts">
                        <h3>Alertas Recientes</h3>
                        <div id="recentAlerts" class="alerts-list">
                            <!-- Alertas se cargar√°n aqu√≠ -->
                        </div>
                    </div>
                </section>

                <!-- Structure Section -->
                <section id="structure-section" class="section">
                    <div class="section-header">
                        <h2>Estructura Institucional</h2>
                        <div class="structure-actions">
                            <button id="addProgramBtn" class="btn-primary">+ Programa</button>
                            <button id="addFacultyBtn" class="btn-primary">+ Facultad</button>
                            <button id="addCareerBtn" class="btn-primary">+ Carrera</button>
                        </div>
                    </div>

                    <div class="structure-container">
                        <div class="structure-tree" id="structureTree">
                            <!-- √Årbol de estructura se cargar√° aqu√≠ -->
                        </div>
                        
                        <div class="structure-details" id="structureDetails">
                            <div class="details-placeholder">
                                <div class="placeholder-icon">üèõÔ∏è</div>
                                <h3>Selecciona un elemento</h3>
                                <p>Haz clic en cualquier programa, facultad o carrera para ver sus detalles</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Students Section -->
                <section id="students-section" class="section">
                    <div class="section-header">
                        <h2>Gesti√≥n de Estudiantes</h2>
                        <div class="student-filters">
                            <input type="text" id="studentSearch" placeholder="üîç Buscar estudiante...">
                            <select id="studentProgramFilter">
                                <option value="">Todos los programas</option>
                            </select>
                            <select id="studentFacultyFilter">
                                <option value="">Todas las facultades</option>
                            </select>
                            <select id="studentRiskFilter">
                                <option value="">Todos los riesgos</option>
                                <option value="high">Alto Riesgo</option>
                                <option value="medium">Riesgo Moderado</option>
                                <option value="low">Riesgo Leve</option>
                            </select>
                        </div>
                    </div>

                    <div class="students-table-container">
                        <table class="students-table" id="studentsTable">
                            <thead>
                                <tr>
                                    <th>Estudiante</th>
                                    <th>Programa</th>
                                    <th>Facultad</th>
                                    <th>Carrera</th>
                                    <th>Conversaciones</th>
                                    <th>Nivel de Riesgo</th>
                                    <th>√öltima Actividad</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTableBody">
                                <!-- Datos de estudiantes se cargar√°n aqu√≠ -->
                            </tbody>
                        </table>
                    </div>

                    <div class="table-pagination" id="studentsPagination">
                        <!-- Paginaci√≥n -->
                    </div>
                </section>

                <!-- Experts Section -->
                <section id="experts-section" class="section">
                    <div class="section-header">
                        <h2>Gesti√≥n de Expertos</h2>
                        <button id="addExpertBtn" class="btn-primary">+ Agregar Experto</button>
                    </div>

                    <div class="experts-grid" id="expertsGrid">
                        <!-- Expertos se cargar√°n aqu√≠ -->
                    </div>
                </section>

                <!-- Analytics Section -->
                <section id="analytics-section" class="section">
                    <div class="section-header">
                        <h2>Anal√≠ticas Institucionales</h2>
                        <div class="analytics-controls">
                            <select id="analyticsPeriod">
                                <option value="7">√öltima semana</option>
                                <option value="30" selected>√öltimo mes</option>
                                <option value="90">√öltimo trimestre</option>
                                <option value="365">√öltimo a√±o</option>
                            </select>
                            <select id="analyticsView">
                                <option value="general">Vista General</option>
                                <option value="programs">Por Programas</option>
                                <option value="faculties">Por Facultades</option>
                                <option value="careers">Por Carreras</option>
                            </select>
                        </div>
                    </div>

                    <div class="analytics-dashboard">
                        <div class="analytics-row">
                            <div class="analytics-card">
                                <h3>Tendencia de Uso</h3>
                                <div id="usageTrendChart" class="chart-container">
                                    <!-- Gr√°fico de tendencia -->
                                </div>
                            </div>
                            <div class="analytics-card">
                                <h3>Horarios de Actividad</h3>
                                <div id="activityHoursChart" class="chart-container">
                                    <!-- Gr√°fico de horarios -->
                                </div>
                            </div>
                        </div>

                        <div class="analytics-row">
                            <div class="analytics-card full-width">
                                <h3>Distribuci√≥n Geogr√°fica</h3>
                                <div id="geographicDistribution" class="chart-container large">
                                    <!-- Mapa de distribuci√≥n -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports-section" class="section">
                    <div class="section-header">
                        <h2>Reportes Institucionales</h2>
                        <div class="report-actions">
                            <button id="generateReportBtn" class="btn-primary">üìä Generar Reporte</button>
                            <button id="exportReportBtn" class="btn-secondary">üì• Exportar PDF</button>
                        </div>
                    </div>

                    <div class="reports-config">
                        <div class="config-section">
                            <h3>Configuraci√≥n del Reporte</h3>
                            <div class="config-grid">
                                <div class="config-group">
                                    <label>Per√≠odo</label>
                                    <div class="date-range">
                                        <input type="date" id="reportStartDate">
                                        <span>a</span>
                                        <input type="date" id="reportEndDate">
                                    </div>
                                </div>
                                <div class="config-group">
                                    <label>Tipo de Reporte</label>
                                    <select id="reportType">
                                        <option value="comprehensive">Comprehensivo</option>
                                        <option value="risk">An√°lisis de Riesgo</option>
                                        <option value="usage">Uso de la Plataforma</option>
                                        <option value="comparative">Comparativo</option>
                                    </select>
                                </div>
                                <div class="config-group">
                                    <label>Segmentaci√≥n</label>
                                    <select id="reportSegmentation">
                                        <option value="none">Sin segmentaci√≥n</option>
                                        <option value="program">Por Programa</option>
                                        <option value="faculty">Por Facultad</option>
                                        <option value="career">Por Carrera</option>
                                        <option value="semester">Por Semestre</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="config-section">
                            <h3>M√©tricas a Incluir</h3>
                            <div class="metrics-checkboxes">
                                <label><input type="checkbox" name="metrics" value="usage" checked> M√©tricas de Uso</label>
                                <label><input type="checkbox" name="metrics" value="risk" checked> Niveles de Riesgo</label>
                                <label><input type="checkbox" name="metrics" value="demographics"> Datos Demogr√°ficos</label>
                                <label><input type="checkbox" name="metrics" value="trends"> Tendencias</label>
                                <label><input type="checkbox" name="metrics" value="comparisons"> Comparaciones</label>
                                <label><input type="checkbox" name="metrics" value="recommendations"> Recomendaciones</label>
                            </div>
                        </div>
                    </div>

                    <div id="reportPreview" class="report-preview">
                        <!-- Vista previa del reporte -->
                    </div>
                </section>

                <!-- Institution Settings Section -->
                <section id="institution-settings-section" class="section">
                    <div class="section-header">
                        <h2>Configuraci√≥n de la Instituci√≥n</h2>
                        <button id="saveSettingsBtn" class="btn-primary">üíæ Guardar Cambios</button>
                    </div>

                    <div class="settings-tabs">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-tab="general">General</button>
                            <button class="tab-btn" data-tab="integration">Integraci√≥n</button>
                            <button class="tab-btn" data-tab="notifications">Notificaciones</button>
                            <button class="tab-btn" data-tab="security">Seguridad</button>
                        </div>

                        <div class="tab-content">
                            <!-- General Tab -->
                            <div id="general-tab" class="tab-pane active">
                                <div class="settings-form">
                                    <div class="form-section">
                                        <h3>Informaci√≥n B√°sica</h3>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label>Nombre de la Instituci√≥n *</label>
                                                <input type="text" id="institutionNameSetting" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Email de Contacto *</label>
                                                <input type="email" id="institutionEmailSetting" required>
                                            </div>
                                            <div class="form-group">
                                                <label>Tel√©fono</label>
                                                <input type="tel" id="institutionPhoneSetting">
                                            </div>
                                            <div class="form-group">
                                                <label>C√≥digo de Instituci√≥n *</label>
                                                <input type="text" id="institutionCodeSetting" required>
                                                <small>Los estudiantes usar√°n este c√≥digo para registrarse</small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-section">
                                        <h3>Configuraci√≥n de L√≠mites</h3>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label>L√≠mite de Estudiantes</label>
                                                <input type="number" id="studentLimit" min="1" max="10000">
                                                <small>N√∫mero m√°ximo de estudiantes permitidos</small>
                                            </div>
                                            <div class="form-group">
                                                <label>L√≠mite de Expertos</label>
                                                <input type="number" id="expertLimit" min="1" max="100">
                                                <small>N√∫mero m√°ximo de expertos psicol√≥gicos</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Integration Tab -->
                            <div id="integration-tab" class="tab-pane">
                                <div class="settings-form">
                                    <div class="form-section">
                                        <h3>Integraci√≥n con Sistemas Existentes</h3>
                                        <div class="integration-options">
                                            <div class="integration-card">
                                                <h4>üîÑ Sistema de Gesti√≥n Acad√©mica</h4>
                                                <p>Conecta con tu plataforma acad√©mica existente</p>
                                                <button class="btn-secondary">Configurar</button>
                                            </div>
                                            <div class="integration-card">
                                                <h4>üìß Sistema de Correo Institucional</h4>
                                                <p>Integraci√≥n con el servicio de email</p>
                                                <button class="btn-secondary">Configurar</button>
                                            </div>
                                            <div class="integration-card">
                                                <h4>üîê Sistema de Autenticaci√≥n</h4>
                                                <p>SSO con las credenciales institucionales</p>
                                                <button class="btn-secondary">Configurar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Notifications Tab -->
                            <div id="notifications-tab" class="tab-pane">
                                <div class="settings-form">
                                    <div class="form-section">
                                        <h3>Configuraci√≥n de Alertas</h3>
                                        <div class="notification-settings">
                                            <div class="notification-item">
                                                <label>
                                                    <input type="checkbox" id="emailAlerts" checked>
                                                    Alertas por Email
                                                </label>
                                                <small>Recibir notificaciones por correo electr√≥nico</small>
                                            </div>
                                            <div class="notification-item">
                                                <label>
                                                    <input type="checkbox" id="highRiskAlerts" checked>
                                                    Alertas de Alto Riesgo
                                                </label>
                                                <small>Notificaciones inmediatas para casos de alto riesgo</small>
                                            </div>
                                            <div class="notification-item">
                                                <label>
                                                    <input type="checkbox" id="weeklyReports" checked>
                                                    Reportes Semanales
                                                </label>
                                                <small>Resumen semanal de actividad y m√©tricas</small>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-section">
                                        <h3>Umbrales de Alerta</h3>
                                        <div class="form-grid">
                                            <div class="form-group">
                                                <label>Umbral de Riesgo Alto</label>
                                                <input type="number" id="highRiskThreshold" min="1" max="10" value="7">
                                                <small>Puntaje m√≠nimo para considerar alto riesgo</small>
                                            </div>
                                            <div class="form-group">
                                                <label>Umbral de Riesgo Moderado</label>
                                                <input type="number" id="mediumRiskThreshold" min="1" max="10" value="5">
                                                <small>Puntaje m√≠nimo para considerar riesgo moderado</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Tab -->
                            <div id="security-tab" class="tab-pane">
                                <div class="settings-form">
                                    <div class="form-section">
                                        <h3>Configuraci√≥n de Seguridad</h3>
                                        <div class="security-settings">
                                            <div class="security-item">
                                                <label>Requisito de Contrase√±a</label>
                                                <select id="passwordPolicy">
                                                    <option value="basic">B√°sico (6 caracteres)</option>
                                                    <option value="medium" selected>Medio (8 caracteres, may√∫sculas y n√∫meros)</option>
                                                    <option value="strong">Fuerte (10 caracteres, complejidad)</option>
                                                </select>
                                            </div>
                                            <div class="security-item">
                                                <label>Duraci√≥n de Sesi√≥n</label>
                                                <select id="sessionDuration">
                                                    <option value="4">4 horas</option>
                                                    <option value="8">8 horas</option>
                                                    <option value="24" selected>24 horas</option>
                                                    <option value="168">1 semana</option>
                                                </select>
                                            </div>
                                            <div class="security-item">
                                                <label>
                                                    <input type="checkbox" id="require2FA">
                                                    Requerir autenticaci√≥n de dos factores
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-section">
                                        <h3>Registro de Actividad</h3>
                                        <div class="activity-log-settings">
                                            <div class="log-item">
                                                <label>Retenci√≥n de Logs</label>
                                                <select id="logRetention">
                                                    <option value="30">30 d√≠as</option>
                                                    <option value="90" selected>90 d√≠as</option>
                                                    <option value="365">1 a√±o</option>
                                                    <option value="730">2 a√±os</option>
                                                </select>
                                            </div>
                                            <div class="log-item">
                                                <label>
                                                    <input type="checkbox" id="auditLog" checked>
                                                    Habilitar registro de auditor√≠a
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Modales -->
    <div id="addProgramModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Nuevo Programa</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addProgramForm">
                <div class="form-group">
                    <label>Nombre del Programa *</label>
                    <input type="text" id="programName" required>
                </div>
                <div class="form-group">
                    <label>Tipo de Programa *</label>
                    <select id="programType" required>
                        <option value="pregrado">Pregrado</option>
                        <option value="posgrado">Posgrado</option>
                        <option value="diplomado">Diplomado</option>
                        <option value="curso">Curso</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Duraci√≥n</label>
                    <input type="text" id="programDuration" placeholder="Ej: 4 a√±os, 6 semestres">
                </div>
                <div class="form-group">
                    <label>Descripci√≥n</label>
                    <textarea id="programDescription" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear Programa</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addFacultyModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Nueva Facultad</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addFacultyForm">
                <div class="form-group">
                    <label>Nombre de la Facultad *</label>
                    <input type="text" id="facultyName" required>
                </div>
                <div class="form-group">
                    <label>Decano</label>
                    <input type="text" id="facultyDean">
                </div>
                <div class="form-group">
                    <label>Email de Contacto</label>
                    <input type="email" id="facultyEmail">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear Facultad</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addCareerModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Nueva Carrera</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addCareerForm">
                <div class="form-group">
                    <label>Nombre de la Carrera *</label>
                    <input type="text" id="careerName" required>
                </div>
                <div class="form-group">
                    <label>C√≥digo</label>
                    <input type="text" id="careerCode">
                </div>
                <div class="form-group">
                    <label>Programa *</label>
                    <select id="careerProgram" required>
                        <option value="">Seleccionar programa...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Facultad *</label>
                    <select id="careerFaculty" required>
                        <option value="">Seleccionar facultad...</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear Carrera</button>
                </div>
            </form>
        </div>
    </div>

    <div id="addExpertModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Nuevo Experto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="addExpertForm">
                <div class="form-group">
                    <label>Nombre Completo *</label>
                    <input type="text" id="expertFullName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="expertEmail" required>
                </div>
                <div class="form-group">
                    <label>Contrase√±a *</label>
                    <input type="password" id="expertPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Especializaci√≥n *</label>
                    <input type="text" id="expertSpecialization" required>
                </div>
                <div class="form-group">
                    <label>N√∫mero de Licencia</label>
                    <input type="text" id="expertLicense">
                </div>
                <div class="form-group">
                    <label>A√±os de Experiencia</label>
                    <input type="number" id="expertExperience" min="0" max="50">
                </div>
                <div class="form-group">
                    <label>Biograf√≠a</label>
                    <textarea id="expertBio" rows="3" placeholder="Breve descripci√≥n profesional..."></textarea>
                </div>
                <div class="form-group">
                    <label>√Åreas de Asignaci√≥n</label>
                    <div class="assignment-areas">
                        <div class="area-selection">
                            <label>Programas:</label>
                            <div id="programAssignments" class="checkbox-group">
                                <!-- Programas para asignar -->
                            </div>
                        </div>
                        <div class="area-selection">
                            <label>Facultades:</label>
                            <div id="facultyAssignments" class="checkbox-group">
                                <!-- Facultades para asignar -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary close-modal">Cancelar</button>
                    <button type="submit" class="btn-primary">Crear Experto</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/institutional-admin.js"></script>
</body>
</html>